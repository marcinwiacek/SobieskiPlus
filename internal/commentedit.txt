
<link type="text/css" rel="stylesheet" href="external/suneditor.min.css">
<script src="external/suneditor.min.js"></script>

<div class=ramki>
  <form id=commentedit name=commentedit method=post>
      <textarea id="editor-container"></textarea><p>
      <button id=sub type="submit">Dodaj komentarz</button>
  </form>
  <div style='display:none' id=progressinfo>Postęp: <progress id="progress" value="0"></progress><div id=progresserror></div></div>
</div>
<script async=async>

var suneditor = SUNEDITOR.create('editor-container',{
  height : '100%',
  width:'auto',
  showPathLabel : false,
  charCounter : true,
  maxCharCount:10000,
  placeholder: 'Poproszę o ładny komentarz'
});

function sprawdz() {
  if (suneditor.getContents(true).trim().length==0) {
    document.getElementById('sub').disabled=true;
  } else {
    document.getElementById('sub').disabled=false;
  }
}
document.getElementById('sub').disabled=true;
suneditor.onChange = function (contents, core) { sprawdz() }

document.commentedit.onsubmit = function() {
  var progressBar = document.getElementById("progress");
  var http = new XMLHttpRequest();
  var url = window.location.protocol+'//'+window.location.hostname+':'+window.location.port+window.location.pathname;
  var params = 'q=upload_comment&obj=<!--OBJECT-->&tekst=<!--PAGEID-->&comment='+encodeURIComponent(suneditor.getContents(true));

  http.open('POST', url, true);
  http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
  http.onprogress = function(e) {
    if (e.lengthComputable) {
        progressBar.max = e.total;
        progressBar.value = e.loaded;
    }
  };
  http.onloadstart = function() {
    document.getElementById("progressinfo").style.display="block";
    document.getElementById("progress").innerHTML="";
    progressBar.value = 0;
  };
  http.onload = function() {
    progressBar.value = progressBar.max;
    document.getElementById("progressinfo").style.display="none";
    suneditor.setContents('');
  };
  http.onerror = function () {
    document.getElementById("progress").innerHTML="error";
  };

  http.send(params);

  return false;
};
</script>
