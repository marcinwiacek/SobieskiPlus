<!doctype html>
<html>

<head>
 <!--STYLES-->
 <script src="external/sha256.js" async defer></script>
 <script async>
  <!--JSASYNC-->

  function getRadio() {
   var r = "";
   var e = document.getElementsByTagName('input');
   for (i = 0; i < e.length; i++) {
    if (e[i].type == "radio" && e[i].checked) {
     r = e[i].value;
     break;
    }
   }
   return r;
  }

  function sprawdz() {
   if ("new_user" == "<!--OPERATION-->") {
    document.getElementById('sub').disabled = 
      (document.getElementById("username").value == "" || 
        document.getElementById("mail").value == "" || 
        (getRadio() == "wlasne" && (document.getElementById("pass").value == "" || 
           document.getElementById("pass2").value == "")));
   } else {
     document.getElementById('sub').disabled = 
       (document.getElementById("mail").value == "");
   }
  }

document.addEventListener("DOMContentLoaded", function(event) {
  sprawdz();
});

  function setWlasne() {
   document.getElementById('wlasne').style.visibility = "visible";
   document.getElementById('wlasne2').style.visibility = "visible";
   sprawdz();
  }

  function setGoogle() {
   document.getElementById('wlasne').style.visibility = "collapse";
   document.getElementById('wlasne2').style.visibility = "collapse";
   sprawdz();
  }

  function sendF() {
   if (getRadio() == "wlasne") {
    var pass = document.getElementById("pass").value;
    var pass2 = document.getElementById("pass2").value;
    if (pass != pass2) {
     alert('Hasła muszą się zgadzać');
     return false;
    }
   }
   var mail = document.getElementById("mail").value;
   if ("new_user" == "<!--OPERATION-->") {
    var username = document.getElementById("username").value;
    var params = '<!--OPERATION-->=1&username=' + username + '&mail=' + mail;
    if (getRadio() == "wlasne") {
     params += '&typ=w&pass=' + sha256(pass);
    } else {
     params += '&typ=g';
    }
   } else {
    var params = 'q=<!--OPERATION-->&mail=' + mail;
    if (getRadio() == "wlasne") {
     params += '&typ=w';
     if (pass != "") params += '&pass=' + sha256(pass);
    } else {
     params += '&typ=g';
    }
   }
   http = createPOST();
   http.onload = function() {
    if (http.status != 200) {
     alert(http.response);
    } else {
     if ("new_user" == "<!--OPERATION-->") {
      if (getRadio() == "wlasne") {
       alert('Konto założone. Konieczna jest jeszcze weryfikacja adresu email.');
      } else {
       alert('Konto założone. Adres musi być zweryfikowany przez Google.');
      }
     } else {
      alert('Konto zmienione.');
     }
     window.location.href = '/';
    }
   };
   http.onerror = function() {
    alert(http.response);
   };
   http.send(params);
   return false;
  };
 </script>
 <meta charset='utf-8'>
 <title>Nowe konto</title>
</head>

<body>
 <!--MENU-->
 <div class=content>
  <div class=ramki> Nowy użytkownik/edycja użytkownika </div>
  <div class=ramki>
   <form onsubmit="return sendF()" autocomplete="off">
    <table>
     <tr>
      <td colspan=2>
       <input name=type id=w type="radio" <!--CHECKED-WLASNE--> value="wlasne" onClick="setWlasne()">
       <label for=w>Konto z własnym hasłem (wymaga weryfikacji email)</label>
       <p>
        <input name=type id=g type="radio" <!--CHECKED-GOOGLE--> value="google" onClick="setGoogle()">
        <label for=g>Konto z logowaniem przez Google (wymaga założonego konta Google z podanym email; weryfikacja maila przez Google)</label>
      </td>
     </tr>
     <tr>
      <td>Unikalny nick w serwisie:</td>
      <td><input oninput="sprawdz()" id=username type="text" size=50 <!--USER-PARAMS--> ></td>
     </tr>
     <tr>
      <td>Unikalny mail w serwisie:</td>
      <td><input oninput="sprawdz()" id=mail type="text" <!--MAIL-PARAMS--> size=50></td>
     </tr>
     <tr id=wlasne>
      <td>Password:</td>
      <td><input oninput="sprawdz()" id=pass type="password" value="" <!--PASS-PARAMS--> size=50><br></td>
     </tr>
     <tr id=wlasne2>
      <td>Repeat password:</td>
      <td><input oninput="sprawdz()" id=pass2 type="password" value="" <!--PASS-PARAMS--> size=50></td>
     </tr>
     <tr>
      <td colspan=2><button type="submit" id=sub>Zapisz</button></td>
     </tr>
    </table>
   </form>
  </div>
 </div>
</body>

</html>