<!doctype html>
<html>

<head>
 <!--STYLES-->
 <script src="external/sha256.js" async defer></script>
 <link type="text/css" rel="stylesheet" href="external/suneditor.min.css">
 <script src="external/suneditor.min.js"></script>
 <script async>
  <!--JSASYNC-->

  function getRadio(name) {
   var r = "";
   var e = document.getElementsByTagName('input');
   for (i = 0; i < e.length; i++) {
    if (e[i].name==name && e[i].type == "radio" && e[i].checked) {
     r = e[i].value;
     break;
    }
   }
   return r;
  }

  function sprawdz() {
   if ("new_user" == "<!--OPERATION-->") {
    document.getElementById('sub').disabled = 
      (document.getElementById("username").value == "" || 
        document.getElementById("mail").value == "" || 
        (getRadio("type") == "wlasne" && (document.getElementById("pass").value == "" || 
           document.getElementById("pass2").value == "")));
   } else {
     document.getElementById('sub').disabled = 
       (document.getElementById("mail").value == "");
   }
  }

  document.addEventListener("DOMContentLoaded", function(event) {
    sprawdz();
  });

  function setWlasne() {
   document.getElementById('wlasne').style.visibility = "visible";
   document.getElementById('wlasne2').style.visibility = "visible";
   sprawdz();
  }

  function setGoogle() {
   document.getElementById('wlasne').style.visibility = "collapse";
   document.getElementById('wlasne2').style.visibility = "collapse";
   sprawdz();
  }

  function sendF() {
   if (getRadio("type") == "wlasne") {
    var pass = document.getElementById("pass").value;
    var pass2 = document.getElementById("pass2").value;
    if (pass != pass2) {
     alert('Hasła muszą się zgadzać');
     return false;
    }
   }
   var mail = document.getElementById("mail").value;
   if ("new_user" == "<!--OPERATION-->") {
    var username = document.getElementById("username").value;
    var params = '<!--OPERATION-->=1&username=' + username + '&mail=' + mail;
    if (getRadio("type") == "wlasne") {
     params += '&typ=w&pass=' + sha256(pass);
    } else {
     params += '&typ=g';
    }
   } else {
    var params = 'q=<!--OPERATION-->&mail=' + mail;
    if (getRadio("type") == "wlasne") {
     params += '&typ=w';
     if (pass != "") params += '&pass=' + sha256(pass);
    } else {
     params += '&typ=g';
    }
   }
   http = createPOST();
   http.onload = function() {
    if (http.status != 200) {
     alert(http.response);
    } else {
     if ("new_user" == "<!--OPERATION-->") {
      if (getRadio("type") == "wlasne") {
       alert('Konto założone. Konieczna jest jeszcze weryfikacja adresu email.');
      } else {
       alert('Konto założone. Adres musi być zweryfikowany przez Google.');
      }
     } else {
      alert('Konto zmienione.');
     }
     window.location.href = '/';
    }
   };
   http.onerror = function() {
    alert(http.response);
   };
   http.send(params+"&level="+getRadio('userlevel'));
   return false;
  };

var suneditornote = null;
var suneditorsig = null;
document.addEventListener("DOMContentLoaded", function(event) {
 suneditornote = SUNEDITOR.create('editor-container-note', {
  height: '100%',
  width: 'auto',
  showPathLabel: false,
  charCounter: true,
  maxCharCount: 10000,
  placeholder: 'Wykaż się kunsztem'
 });
 suneditorsig = SUNEDITOR.create('editor-container-sig', {
  height: '100%',
  width: 'auto',
  showPathLabel: false,
  charCounter: true,
  maxCharCount: 10000,
  placeholder: 'Niechaj narodowie żadni nam się nie dziwują, jak Polacy pięknie siem tu podpisują'
 });
});
 </script>
 <meta charset='utf-8'>
 <title>Nowe konto</title>
</head>

<body>
 <!--MENU-->
 <div class=content>
  <div class=ramki> Nowy użytkownik/edycja użytkownika </div>
  <div class=ramki>
   <form onsubmit="return sendF()" autocomplete="off">
    <table width=100%>
     <tr>
      <td colspan=2>
       Poziom dostępu<br>
       <!--LEVEL-->
      </td>
     </tr>
     <tr>
      <td colspan=2>
       <br>Rodzaj konta<br>
       <input name=type id=w type="radio" <!--CHECKED-WLASNE--> value="wlasne" onClick="setWlasne()">
       <label for=w>Konto z własnym hasłem (wymaga weryfikacji email)</label>
       <p>
        <input name=type id=g type="radio" <!--CHECKED-GOOGLE--> value="google" onClick="setGoogle()">
        <label for=g>Konto z logowaniem przez Google (wymaga założonego konta Google z podanym email; weryfikacja maila przez Google)</label>
      </td>
     </tr>
     <tr>
      <td>Unikalny nick w serwisie:</td>
      <td><input oninput="sprawdz()" id=username type="text" size=50 <!--USER-PARAMS--> ></td>
     </tr>
     <tr>
      <td>Unikalny mail w serwisie:</td>
      <td><input oninput="sprawdz()" id=mail type="text" <!--MAIL-PARAMS--> size=50></td>
     </tr>
     <tr id=wlasne>
      <td>Hasło:</td>
      <td><input oninput="sprawdz()" id=pass type="password" value="" <!--PASS-PARAMS--> size=50><br></td>
     </tr>
     <tr id=wlasne2>
      <td>Powtórz hasło:</td>
      <td><input oninput="sprawdz()" id=pass2 type="password" value="" <!--PASS-PARAMS--> size=50></td>
     </tr>
     <tr><td colspan=2>
       <p>Notka na stronie (opcjonalna)<br>
       <textarea id="editor-container-note"></textarea>
     </td></tr>
     <tr><td colspan=2>
       Stopka do komentarzy (opcjonalna)<br>
       <textarea id="editor-container-sig"></textarea>
     </td></tr>
     <tr>
      <td colspan=2><button type="submit" id=sub>Zapisz</button></td>
     </tr>
    </table>
   </form>
  </div>
 </div>
</body>

</html>